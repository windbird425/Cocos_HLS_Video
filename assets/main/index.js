System.register("chunks:///_virtual/cocos-hls-player.ts",["cc","./hls.mjs"],(function(t){var e,i,n,o;return{setters:[function(t){e=t.cclegacy,i=t.warn,n=t.error},function(t){o=t.Hls}],execute:function(){e._RF.push({},"4a505Vl+DpKaIC3Y93JGVyY","cocos-hls-player",void 0);t("HlsPlayer",function(){function t(t){if(this.hls=void 0,this.videoDOM=void 0,this.videoURL=void 0,this.timeUpdateCallback=void 0,!t.hls.isSupported())throw new Error("当前环境不支持 HLS！");this.hls=new t.hls,this.videoDOM=t.videoDOM,this.videoURL=t.videoURL,this.timeUpdateCallback=t.timeUpdate,this.hls.attachMedia(this.videoDOM),this.initEventListeners()}var e=t.prototype;return e.initEventListeners=function(){var t=this;this.videoDOM.addEventListener("timeupdate",(function(){var e=t.videoDOM,i=e.currentTime,n=e.duration;t.timeUpdateCallback&&t.timeUpdateCallback(i,n,i/n*100)})),this.hls.on(o.Events.MEDIA_ATTACHED,(function(){i("HLS 已绑定 Video 标签",t.videoDOM);var e=t.selectBestURL();e?(t.hls.loadSource(e),t.hls.on(o.Events.MANIFEST_PARSED,(function(){t.videoDOM.play().then((function(){t.videoDOM.muted=!1})).catch((function(t){n("HLS 播放错误",t)}))}))):n("HLS 地址为空")}))},e.selectBestURL=function(){var t=Object.entries(this.videoURL).map((function(t){return{type:t[0],url:t[1]}}));return t.sort((function(t,e){return"origin"===t.type||"origin"===e.type?0:Number(e.type)-Number(t.type)})),t.length>0?t[0].url:null},e.seek=function(t){this.videoDOM.currentTime=t},e.play=function(){this.videoDOM.play().catch((function(t){return n("播放失败",t)}))},e.stop=function(){this.videoDOM.pause(),this.videoDOM.currentTime=0},e.pause=function(){this.videoDOM.pause()},e.toggle=function(){this.videoDOM.paused?this.videoDOM.play():this.videoDOM.pause()},e.destroy=function(){this.hls.destroy()},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/HelloWorld.ts",["./rollupPluginModLoBabelHelpers.js","cc","./VideoPlayerEx.ts"],(function(e){var t,i,r,o,s,a,n,l,h,d,p,c,u,g,m,v,f,y;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,r=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){s=e.cclegacy,a=e._decorator,n=e.Node,l=e.Toggle,h=e.Sprite,d=e.resources,p=e.instantiate,c=e.Vec2,u=e.UITransform,g=e.Texture2D,m=e.SpriteFrame,v=e.log,f=e.Component},function(e){y=e.VideoPlayerEx}],execute:function(){var N,w,x,F,b,C,P;s._RF.push({},"280c3rsZJJKnZ9RqbALVwtK","HelloWorld",void 0);var M=a.ccclass,V=a.property;e("HelloWorld",(N=M("HelloWorld"),w=V(n),x=V(l),N((C=t((b=function(e){function t(){for(var t,i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return t=e.call.apply(e,[this].concat(s))||this,r(t,"spriteNode",C,o(t)),r(t,"filmStyleToggle",P,o(t)),t.videoNode=null,t.spriteNodeMaterial=void 0,t.videoDOM=void 0,t.canvas=void 0,t.ctx=void 0,t.imageAsset=void 0,t.texture=void 0,t.spriteFrame=void 0,t}i(t,e);var s=t.prototype;return s.onLoad=function(){this.videoNode=null,this.spriteNodeMaterial=this.spriteNode.getComponent(h).getSharedMaterial(0)},s.start=function(){var e={videoURLs:{1080:"https://live-hls-web-aje.getaj.net/AJE/01.m3u8",720:"https://live-hls-web-aje.getaj.net/AJE/01.m3u8",origin:"https://live-hls-web-aje.getaj.net/AJE/01.m3u8"},posterURL:"img/poster.jpg"};d.load("prefab/VideoPlayer",function(t,i){var r=p(i);this.node.addChild(r),r.setPosition(-410,30),r.getComponent("VideoPlayerEx").createHls(e),this.videoNode=r,this._initVideo()}.bind(this))},s.update=function(e){this.filmStyleToggle.isChecked&&(this.spriteNodeMaterial.setProperty("resolution",new c(this.spriteNode.getComponent(u).width,this.spriteNode.getComponent(u).height)),this.spriteNodeMaterial.setProperty("time",performance.now()/1e3))},s._initVideo=function(){this.videoDOM=this.videoNode.getComponent(y).VideoPlayer.nativeVideo,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.canvas.width=this.spriteNode.getComponent(u).width,this.canvas.height=this.spriteNode.getComponent(u).height,this.texture=new g,this.texture.reset({width:this.canvas.width,height:this.canvas.height,format:g.PixelFormat.RGBA8888}),this.spriteFrame=new m,this.spriteFrame.texture=this.texture,this.spriteNode.getComponent(h).spriteFrame=this.spriteFrame,this.schedule(this._updateFrame.bind(this),1/60)},s._updateFrame=function(){if(this.videoDOM.readyState>=2){this.ctx.drawImage(this.videoDOM,0,0,this.canvas.width,this.canvas.height);var e=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height);this.texture.uploadData(e.data),this.spriteFrame.texture=this.texture,this.spriteNode.getComponent(h).spriteFrame=this.spriteFrame}},s.setVideoSpriteGray=function(e,t){v(e.progress),this.spriteNodeMaterial.setProperty("grayEffect",e.progress)},s.onToggleFilmStyle=function(e,t){this.spriteNodeMaterial.setProperty("enableFilmEffect",Number(e.isChecked))},t}(f)).prototype,"spriteNode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(b.prototype,"filmStyleToggle",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=b))||F));s._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./HelloWorld.ts","./cocos-hls-player.ts","./VideoPlayerEx.ts"],(function(){return{setters:[null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/VideoPlayerEx.ts",["./rollupPluginModLoBabelHelpers.js","cc","./cocos-hls-player.ts","./hls.mjs"],(function(e){var i,t,o,n,a,r,l,s,d,c,u;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.inheritsLoose,o=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){a=e.cclegacy,r=e._decorator,l=e.Node,s=e.VideoPlayer,d=e.Component},function(e){c=e.HlsPlayer},function(e){u=e.Hls}],execute:function(){var p,h,y,V,v;a._RF.push({},"5c9151ELjtKy6oJwS0IjBH7","VideoPlayerEx",void 0);var f=r.ccclass,P=r.property;e("VideoPlayerEx",(p=f("VideoPlayerEx"),h=P(l),p((v=i((V=function(e){function i(){for(var i,t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return i=e.call.apply(e,[this].concat(a))||this,o(i,"vidioNode",v,n(i)),i.hls=null,i.VideoPlayer=null,i}t(i,e);var a=i.prototype;return a.onLoad=function(){this.hls=null,this.VideoPlayer=this.vidioNode.getComponent(s),this.VideoPlayer._impl.createVideoPlayer("")},a.start=function(){},a.update=function(e){},a.addRemoteUrl=function(){},a.changeRemoteUrl=function(){},a.timeUpdate=function(e,i,t){},a.setCurrentTime=function(e){this.hls.seek(e)},a.playVideo=function(){this.hls.play()},a.stopVideo=function(){this.hls.stop()},a.pauseVideo=function(){this.hls.pause()},a.toggle=function(e,i){this.hls.toggle()},a.createHls=function(e){this.VideoPlayer.nativeVideo.controls=!0,this.VideoPlayer.nativeVideo.crossOrigin="anonymous",this.VideoPlayer.nativeVideo.poster=e.posterURL,this.VideoPlayer.nativeVideo.disablePictureInPicture=!0,this.VideoPlayer.nativeVideo.addEventListener("click",this._mouseHandler,!1),this.VideoPlayer.nativeVideo.muted=!0,this.VideoPlayer.nativeVideo.canPlayType("application/vnd.apple.mpegurl")?this.VideoPlayer.nativeVideo.src=e.videoURLs.origin:this.hls=new c({hls:u,videoDOM:this.VideoPlayer.nativeVideo,videoURL:e.videoURLs,timeUpdate:this.timeUpdate}),this.VideoPlayer.nativeVideo.autoplay=!0},a._createDOM=function(e,i,t,o){var n=document.createElement(e);return n.classList.add(i),n.id=t,o.appendChild(n),n},a._mouseHandler=function(e){e.preventDefault()},i}(d)).prototype,"vidioNode",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=V))||y));a._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});