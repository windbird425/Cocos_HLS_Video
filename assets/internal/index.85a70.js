System.register("bundle://internal/internal.js",["cc"],(function(){var e,t,a,i,n,r,o,s,l,d,h,p,c,u,g,m,f,b,S,_,w,P;return{setters:[function(y){e=y.cclegacy,t=y.gfx,a=y._decorator,i=y.Camera,n=y.CCBoolean,r=y.CCInteger,o=y.CCFloat,s=y.Material,l=y.Texture2D,d=y.rendering,h=y.Component,p=y.geometry,c=y.renderer,u=y.assert,g=y.Layers,m=y.PipelineEventType,f=y.Vec2,b=y.Vec4,S=y.sys,_=y.pipeline,w=y.Vec3,P=y.clamp}],execute:function(){function y(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(n=i.key,r=void 0,"symbol"==typeof(r=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var i=a.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(n,"string"))?r:String(r)),i)}var n,r}function M(e,t){return(M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}function E(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return R(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?R(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function C(e,t,a,i){a&&Object.defineProperty(e,t,{enumerable:a.enumerable,configurable:a.configurable,writable:a.writable,value:a.initializer?a.initializer.call(i):void 0})}function T(e,t,a,i,n){var r={};return Object.keys(i).forEach((function(e){r[e]=i[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce((function(a,i){return i(e,t,a)||a}),r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}e._RF.push({},"cbf30kCUX9A3K+QpVC6wnzx","builtin-pipeline-types",void 0);var A,x,D,L,O,F,N,G,Q,B,z,H,I,W,k,U,j,V,X,Y,K,q,Z,$,J,ee,te,ae,ie=t.SampleCount;function ne(){return{enabled:!1,sampleCount:ie.X4}}function re(){return{msaa:ne(),enableShadingScale:!1,shadingScale:.5,bloom:{enabled:!1,material:null,enableAlphaMask:!1,iterations:3,threshold:.8,intensity:2.3},toneMapping:{material:null},colorGrading:{enabled:!1,material:null,contribute:1,colorGradingMap:null},fsr:{enabled:!1,material:null,sharpness:.8},fxaa:{enabled:!1,material:null}}}function oe(e){e.msaa?function(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.sampleCount&&(e.sampleCount=ie.X4)}(e.msaa):e.msaa=ne(),void 0===e.enableShadingScale&&(e.enableShadingScale=!1),void 0===e.shadingScale&&(e.shadingScale=.5),e.bloom?function(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null),void 0===e.enableAlphaMask&&(e.enableAlphaMask=!1),void 0===e.iterations&&(e.iterations=3),void 0===e.threshold&&(e.threshold=.8),void 0===e.intensity&&(e.intensity=2.3)}(e.bloom):e.bloom={enabled:!1,material:null,enableAlphaMask:!1,iterations:3,threshold:.8,intensity:2.3},e.toneMapping?function(e){void 0===e.material&&(e.material=null)}(e.toneMapping):e.toneMapping={material:null},e.colorGrading?function(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null),void 0===e.contribute&&(e.contribute=1),void 0===e.colorGradingMap&&(e.colorGradingMap=null)}(e.colorGrading):e.colorGrading={enabled:!1,material:null,contribute:1,colorGradingMap:null},e.fsr?function(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null),void 0===e.sharpness&&(e.sharpness=.8)}(e.fsr):e.fsr={enabled:!1,material:null,sharpness:.8},e.fxaa?function(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null)}(e.fxaa):e.fxaa={enabled:!1,material:null}}e._RF.pop(),e._RF.push({},"de1c2EHcMhAIYRZY5nyTQHG","builtin-pipeline-settings",void 0);var se=a.ccclass,le=a.disallowMultiple,de=a.executeInEditMode,he=a.menu,pe=a.property,ce=a.requireComponent;a.type,A=se("BuiltinPipelineSettings"),x=he("Rendering/BuiltinPipelineSettings"),D=ce(i),L=pe(n),O=pe({displayName:"Editor Preview (Experimental)",type:n}),F=pe({group:{id:"MSAA",name:"Multisample Anti-Aliasing"},type:n}),N=pe({group:{id:"MSAA",name:"Multisample Anti-Aliasing",style:"section"},type:r,range:[2,4,2]}),G=pe({group:{id:"ShadingScale",name:"ShadingScale",style:"section"},type:n}),Q=pe({tooltip:"i18n:postprocess.shadingScale",group:{id:"ShadingScale",name:"ShadingScale"},type:o,range:[.01,4,.01],slide:!0}),B=pe({group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:n}),z=pe({group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:s}),H=pe({tooltip:"i18n:bloom.enableAlphaMask",group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:n}),I=pe({tooltip:"i18n:bloom.iterations",group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:r,range:[1,6,1],slide:!0}),W=pe({tooltip:"i18n:bloom.threshold",group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:o,min:0}),k=pe({group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:n}),U=pe({group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:s}),j=pe({tooltip:"i18n:color_grading.contribute",group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:o,range:[0,1,.01],slide:!0}),V=pe({tooltip:"i18n:color_grading.originalMap",group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:l}),X=pe({group:{id:"FXAA",name:"Fast Approximate Anti-Aliasing (PostProcessing)",style:"section"},type:n}),Y=pe({group:{id:"FXAA",name:"Fast Approximate Anti-Aliasing (PostProcessing)",style:"section"},type:s}),K=pe({group:{id:"FSR",name:"FidelityFX Super Resolution",style:"section"},type:n}),q=pe({group:{id:"FSR",name:"FidelityFX Super Resolution",style:"section"},type:s}),Z=pe({group:{id:"FSR",name:"FidelityFX Super Resolution",style:"section"},type:o,range:[0,1,.01],slide:!0}),$=pe({group:{id:"ToneMapping",name:"ToneMapping",style:"section"},type:s}),A(J=x(J=D(J=le(J=de((te=T((ee=function(e){var t,a;function n(){for(var t,a=arguments.length,i=new Array(a),n=0;n<a;n++)i[n]=arguments[n];return C(t=e.call.apply(e,[this].concat(i))||this,"_settings",te,v(t)),C(t,"_editorPreview",ae,v(t)),t}a=e,(t=n).prototype=Object.create(a.prototype),t.prototype.constructor=t,M(t,a);var r,o,s,l=n.prototype;return l.getPipelineSettings=function(){return this._settings},l.onEnable=function(){oe(this._settings),this.getComponent(i).camera.pipelineSettings=this._settings},l.onDisable=function(){this.getComponent(i).camera.pipelineSettings=null},l._tryEnableEditorPreview=function(){void 0!==d&&(this._editorPreview?d.setEditorPipelineSettings(this._settings):this._disableEditorPreview())},l._disableEditorPreview=function(){void 0!==d&&(d.getEditorPipelineSettings()===this._settings&&d.setEditorPipelineSettings(null))},r=n,(o=[{key:"editorPreview",get:function(){return this._editorPreview},set:function(e){this._editorPreview=e}},{key:"MsaaEnable",get:function(){return this._settings.msaa.enabled},set:function(e){this._settings.msaa.enabled=e}},{key:"msaaSampleCount",get:function(){return this._settings.msaa.sampleCount},set:function(e){e=Math.pow(2,Math.ceil(Math.log2(Math.max(e,2)))),e=Math.min(e,4),this._settings.msaa.sampleCount=e}},{key:"shadingScaleEnable",get:function(){return this._settings.enableShadingScale},set:function(e){this._settings.enableShadingScale=e}},{key:"shadingScale",get:function(){return this._settings.shadingScale},set:function(e){this._settings.shadingScale=e}},{key:"bloomEnable",get:function(){return this._settings.bloom.enabled},set:function(e){this._settings.bloom.enabled=e}},{key:"bloomMaterial",get:function(){return this._settings.bloom.material},set:function(e){this._settings.bloom.material!==e&&(this._settings.bloom.material=e)}},{key:"bloomEnableAlphaMask",get:function(){return this._settings.bloom.enableAlphaMask},set:function(e){this._settings.bloom.enableAlphaMask=e}},{key:"bloomIterations",get:function(){return this._settings.bloom.iterations},set:function(e){this._settings.bloom.iterations=e}},{key:"bloomThreshold",get:function(){return this._settings.bloom.threshold},set:function(e){this._settings.bloom.threshold=e}},{key:"bloomIntensity",get:function(){return this._settings.bloom.intensity},set:function(e){this._settings.bloom.intensity=e}},{key:"colorGradingEnable",get:function(){return this._settings.colorGrading.enabled},set:function(e){this._settings.colorGrading.enabled=e}},{key:"colorGradingMaterial",get:function(){return this._settings.colorGrading.material},set:function(e){this._settings.colorGrading.material!==e&&(this._settings.colorGrading.material=e)}},{key:"colorGradingContribute",get:function(){return this._settings.colorGrading.contribute},set:function(e){this._settings.colorGrading.contribute=e}},{key:"colorGradingMap",get:function(){return this._settings.colorGrading.colorGradingMap},set:function(e){this._settings.colorGrading.colorGradingMap=e}},{key:"fxaaEnable",get:function(){return this._settings.fxaa.enabled},set:function(e){this._settings.fxaa.enabled=e}},{key:"fxaaMaterial",get:function(){return this._settings.fxaa.material},set:function(e){this._settings.fxaa.material!==e&&(this._settings.fxaa.material=e)}},{key:"fsrEnable",get:function(){return this._settings.fsr.enabled},set:function(e){this._settings.fsr.enabled=e}},{key:"fsrMaterial",get:function(){return this._settings.fsr.material},set:function(e){this._settings.fsr.material!==e&&(this._settings.fsr.material=e)}},{key:"fsrSharpness",get:function(){return this._settings.fsr.sharpness},set:function(e){this._settings.fsr.sharpness=e}},{key:"toneMappingMaterial",get:function(){return this._settings.toneMapping.material},set:function(e){this._settings.toneMapping.material!==e&&(this._settings.toneMapping.material=e)}}])&&y(r.prototype,o),s&&y(r,s),Object.defineProperty(r,"prototype",{writable:!1}),n}(h)).prototype,"_settings",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return re()}}),ae=T(ee.prototype,"_editorPreview",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),T(ee.prototype,"editorPreview",[O],Object.getOwnPropertyDescriptor(ee.prototype,"editorPreview"),ee.prototype),T(ee.prototype,"MsaaEnable",[F],Object.getOwnPropertyDescriptor(ee.prototype,"MsaaEnable"),ee.prototype),T(ee.prototype,"msaaSampleCount",[N],Object.getOwnPropertyDescriptor(ee.prototype,"msaaSampleCount"),ee.prototype),T(ee.prototype,"shadingScaleEnable",[G],Object.getOwnPropertyDescriptor(ee.prototype,"shadingScaleEnable"),ee.prototype),T(ee.prototype,"shadingScale",[Q],Object.getOwnPropertyDescriptor(ee.prototype,"shadingScale"),ee.prototype),T(ee.prototype,"bloomEnable",[B],Object.getOwnPropertyDescriptor(ee.prototype,"bloomEnable"),ee.prototype),T(ee.prototype,"bloomMaterial",[z],Object.getOwnPropertyDescriptor(ee.prototype,"bloomMaterial"),ee.prototype),T(ee.prototype,"bloomEnableAlphaMask",[H],Object.getOwnPropertyDescriptor(ee.prototype,"bloomEnableAlphaMask"),ee.prototype),T(ee.prototype,"bloomIterations",[I],Object.getOwnPropertyDescriptor(ee.prototype,"bloomIterations"),ee.prototype),T(ee.prototype,"bloomThreshold",[W],Object.getOwnPropertyDescriptor(ee.prototype,"bloomThreshold"),ee.prototype),T(ee.prototype,"colorGradingEnable",[k],Object.getOwnPropertyDescriptor(ee.prototype,"colorGradingEnable"),ee.prototype),T(ee.prototype,"colorGradingMaterial",[U],Object.getOwnPropertyDescriptor(ee.prototype,"colorGradingMaterial"),ee.prototype),T(ee.prototype,"colorGradingContribute",[j],Object.getOwnPropertyDescriptor(ee.prototype,"colorGradingContribute"),ee.prototype),T(ee.prototype,"colorGradingMap",[V],Object.getOwnPropertyDescriptor(ee.prototype,"colorGradingMap"),ee.prototype),T(ee.prototype,"fxaaEnable",[X],Object.getOwnPropertyDescriptor(ee.prototype,"fxaaEnable"),ee.prototype),T(ee.prototype,"fxaaMaterial",[Y],Object.getOwnPropertyDescriptor(ee.prototype,"fxaaMaterial"),ee.prototype),T(ee.prototype,"fsrEnable",[K],Object.getOwnPropertyDescriptor(ee.prototype,"fsrEnable"),ee.prototype),T(ee.prototype,"fsrMaterial",[q],Object.getOwnPropertyDescriptor(ee.prototype,"fsrMaterial"),ee.prototype),T(ee.prototype,"fsrSharpness",[Z],Object.getOwnPropertyDescriptor(ee.prototype,"fsrSharpness"),ee.prototype),T(ee.prototype,"toneMappingMaterial",[$],Object.getOwnPropertyDescriptor(ee.prototype,"toneMappingMaterial"),ee.prototype),J=ee))||J)||J)||J)||J);e._RF.pop(),e._RF.push({},"ff9b0GZzgRM/obMbHGfCNbk","builtin-pipeline",void 0);var ue=p.AABB,ge=p.Sphere,me=p.intersect,fe=t.ClearFlagBit,be=t.Color,Se=t.Format,_e=t.FormatFeatureBit,we=t.LoadOp,Pe=t.StoreOp,ye=t.TextureType,Me=t.Viewport,ve=c.scene,Re=ve.CameraUsage,Ee=ve.CSMLevel,Ce=ve.LightType;function Te(e){return!!(e.clearFlag&(fe.COLOR|fe.STENCIL<<1))}function Ae(e,t,a,i,n,r){e.shadowFixedArea||e.csmLevel===Ee.LEVEL_1?(n.left=0,n.top=0,n.width=Math.trunc(t),n.height=Math.trunc(a)):(n.left=Math.trunc(i%2*.5*t),n.top=r>0?Math.trunc(.5*(1-Math.floor(i/2))*a):Math.trunc(.5*Math.floor(i/2)*a),n.width=Math.trunc(.5*t),n.height=Math.trunc(.5*a)),n.left=Math.max(0,n.left),n.top=Math.max(0,n.top),n.width=Math.max(1,n.width),n.height=Math.max(1,n.height)}var xe=function(){this.isWeb=!1,this.isWebGL1=!1,this.isWebGPU=!1,this.isMobile=!1,this.isHDR=!1,this.useFloatOutput=!1,this.toneMappingType=0,this.shadowEnabled=!1,this.shadowMapFormat=Se.R32F,this.shadowMapSize=new f(1,1),this.usePlanarShadow=!1,this.screenSpaceSignY=1,this.supportDepthSample=!1,this.mobileMaxSpotLightShadowMaps=1,this.platform=new b(0,0,0,0)};function De(e,a){var i=_e.SAMPLED_TEXTURE|_e.LINEAR_FILTER,n=e.device;a.isWeb=!S.isNative,a.isWebGL1=n.gfxAPI===t.API.WEBGL,a.isWebGPU=n.gfxAPI===t.API.WEBGPU,a.isMobile=S.isMobile,a.isHDR=e.pipelineSceneData.isHDR,a.useFloatOutput=e.getMacroBool("CC_USE_FLOAT_OUTPUT"),a.toneMappingType=e.pipelineSceneData.postSettings.toneMappingType;var r=e.pipelineSceneData.shadows;a.shadowEnabled=r.enabled,a.shadowMapFormat=_.supportsR32FloatTexture(e.device)?Se.R32F:Se.RGBA8,a.shadowMapSize.set(r.size),a.usePlanarShadow=r.enabled&&r.type===c.scene.ShadowType.Planar,a.screenSpaceSignY=e.device.capabilities.screenSpaceSignY,a.supportDepthSample=(e.device.getFormatFeatures(Se.DEPTH_STENCIL)&i)===i;var o=n.capabilities.screenSpaceSignY;a.platform.x=a.isMobile?1:0,a.platform.w=.5*o+.5<<1|.5*n.capabilities.clipSpaceSignY+.5}var Le=re(),Oe=function(){this.settings=Le,this.isMainGameWindow=!1,this.renderWindowId=0,this.colorName="",this.depthStencilName="",this.enableFullPipeline=!1,this.enableProfiler=!1,this.remainingPasses=0,this.enableShadingScale=!1,this.shadingScale=1,this.nativeWidth=1,this.nativeHeight=1,this.width=1,this.height=1,this.enableHDR=!1,this.radianceFormat=t.Format.RGBA8,this.copyAndTonemapMaterial=null,this.enableStoreSceneDepth=!1},Fe=new be(0,0,0,0);function Ne(e,t,a,i){u(!!a.copyAndTonemapMaterial);var n=e.addRenderPass(a.nativeWidth,a.nativeHeight,"cc-tone-mapping");return n.addRenderTarget(a.colorName,we.CLEAR,Pe.STORE,Fe),n.addTexture(i,"inputTexture"),n.setVec4("g_platform",t.platform),n.addQueue(d.QueueHint.OPAQUE).addFullscreenQuad(a.copyAndTonemapMaterial,1),n}function Ge(e,t,a){return e.startsWith(t)?""+t+(1-Number(e.charAt(t.length)))+"_"+a:t+"0_"+a}var Qe=function(){function e(){this.lights=[],this.shadowEnabledSpotLights=[],this._sphere=ge.create(0,0,0,1),this._boundingBox=new ue,this._rangedDirLightBoundingBox=new ue(0,0,0,.5,.5,.5)}var t=e.prototype;return t.cullLights=function(e,t,a){this.lights.length=0,this.shadowEnabledSpotLights.length=0;for(var i,n=E(e.spotLights);!(i=n()).done;){var r=i.value;r.baked||(ge.set(this._sphere,r.position.x,r.position.y,r.position.z,r.range),me.sphereFrustum(this._sphere,t)&&(r.shadowEnabled?this.shadowEnabledSpotLights.push(r):this.lights.push(r)))}for(var o,s=E(e.sphereLights);!(o=s()).done;){var l=o.value;l.baked||(ge.set(this._sphere,l.position.x,l.position.y,l.position.z,l.range),me.sphereFrustum(this._sphere,t)&&this.lights.push(l))}for(var d,h=E(e.pointLights);!(d=h()).done;){var p=d.value;p.baked||(ge.set(this._sphere,p.position.x,p.position.y,p.position.z,p.range),me.sphereFrustum(this._sphere,t)&&this.lights.push(p))}for(var c,u=E(e.rangedDirLights);!(c=u()).done;){var g=c.value;ue.transform(this._boundingBox,this._rangedDirLightBoundingBox,g.node.getWorldMatrix()),me.aabbFrustum(this._boundingBox,t)&&this.lights.push(g)}a&&this.shadowEnabledSpotLights.sort((function(e,t){return w.squaredDistance(a,e.position)-w.squaredDistance(a,t.position)}))},t._addLightQueues=function(e,t){for(var a,i=E(this.lights);!(a=i()).done;){var n=a.value,r=t.addQueue(d.QueueHint.BLEND,"forward-add");switch(n.type){case Ce.SPHERE:r.name="sphere-light";break;case Ce.SPOT:r.name="spot-light";break;case Ce.POINT:r.name="point-light";break;case Ce.RANGED_DIRECTIONAL:r.name="ranged-directional-light";break;default:r.name="unknown-light"}r.addScene(e,d.SceneFlags.BLEND,n)}},t.addSpotlightShadowPasses=function(e,t,a){for(var i,n=0,r=E(this.shadowEnabledSpotLights);!(i=r()).done;){var o=i.value,s=e.pipelineSceneData.shadows.size,l=e.addRenderPass(s.x,s.y,"default");if(l.name="SpotLightShadowPass"+n,l.addRenderTarget("SpotShadowMap"+n,we.CLEAR,Pe.STORE,new be(1,1,1,1)),l.addDepthStencil("SpotShadowDepth"+n,we.CLEAR,Pe.DISCARD),l.addQueue(d.QueueHint.NONE,"shadow-caster").addScene(t,d.SceneFlags.OPAQUE|d.SceneFlags.MASK|d.SceneFlags.SHADOW_CASTER).useLightFrustum(o),++n>=a)break}},t.addLightQueues=function(e,t,a){this._addLightQueues(t,e);for(var i,n=0,r=E(this.shadowEnabledSpotLights);!(i=r()).done;){var o=i.value;if(e.addTexture("SpotShadowMap"+n,"cc_spotShadowMap"),e.addQueue(d.QueueHint.BLEND,"forward-add").addScene(t,d.SceneFlags.BLEND,o),++n>=a)break}},t.addLightPasses=function(e,t,a,i,n,r,o,s,l,h){this._addLightQueues(o,h);for(var p,c=0,u=l.pipelineSceneData.shadows.size,g=E(this.shadowEnabledSpotLights);!(p=g()).done;){var m=p.value,f=l.addRenderPass(u.x,u.y,"default");f.name="SpotlightShadowPass",f.addRenderTarget("ShadowMap"+i,we.CLEAR,Pe.STORE,new be(1,1,1,1)),f.addDepthStencil("ShadowDepth"+i,we.CLEAR,Pe.DISCARD),f.addQueue(d.QueueHint.NONE,"shadow-caster").addScene(o,d.SceneFlags.OPAQUE|d.SceneFlags.MASK|d.SceneFlags.SHADOW_CASTER).useLightFrustum(m);var b=++c===this.shadowEnabledSpotLights.length?a:Pe.STORE;(h=l.addRenderPass(n,r,"default")).name="SpotlightWithShadowMap",h.setViewport(s),h.addRenderTarget(e,we.LOAD),h.addDepthStencil(t,we.LOAD,b),h.addTexture("ShadowMap"+i,"cc_spotShadowMap"),h.addQueue(d.QueueHint.BLEND,"forward-add").addScene(o,d.SceneFlags.BLEND,m)}return h},t.isMultipleLightPassesNeeded=function(){return this.shadowEnabledSpotLights.length>0},e}(),Be=function(){function a(){this.forwardLighting=new Qe,this._viewport=new Me,this._clearColor=new be(0,0,0,1),this._reflectionProbeClearColor=new w(0,0,0)}var i=a.prototype;return i.getConfigOrder=function(){return a.ConfigOrder},i.getRenderOrder=function(){return a.RenderOrder},i.configCamera=function(e,t,a){a.enableMainLightShadowMap=t.shadowEnabled&&!t.usePlanarShadow&&!!e.scene&&!!e.scene.mainLight&&e.scene.mainLight.shadowEnabled,a.enableMainLightPlanarShadowMap=t.shadowEnabled&&t.usePlanarShadow&&!!e.scene&&!!e.scene.mainLight&&e.scene.mainLight.shadowEnabled,a.enablePlanarReflectionProbe=a.isMainGameWindow||e.cameraUsage===Re.SCENE_VIEW||e.cameraUsage===Re.GAME_VIEW,a.enableMSAA=a.settings.msaa.enabled&&!a.enableStoreSceneDepth&&!t.isWeb&&!t.isWebGL1,a.enableSingleForwardPass=t.isMobile||a.enableMSAA,++a.remainingPasses},i.windowResize=function(e,t,a,i,n,r,o){var s=d.ResourceFlags,l=d.ResourceResidency,h=i.renderWindowId,p=a.settings,c=a.enableShadingScale?Math.max(Math.floor(r*a.shadingScale),1):r,u=a.enableShadingScale?Math.max(Math.floor(o*a.shadingScale),1):o;if(a.enableMSAA&&(a.enableHDR?e.addTexture("MsaaRadiance"+h,ye.TEX2D,a.radianceFormat,c,u,1,1,1,p.msaa.sampleCount,s.COLOR_ATTACHMENT,l.MEMORYLESS):e.addTexture("MsaaRadiance"+h,ye.TEX2D,Se.RGBA8,c,u,1,1,1,p.msaa.sampleCount,s.COLOR_ATTACHMENT,l.MEMORYLESS),e.addTexture("MsaaDepthStencil"+h,ye.TEX2D,Se.DEPTH_STENCIL,c,u,1,1,1,p.msaa.sampleCount,s.DEPTH_STENCIL_ATTACHMENT,l.MEMORYLESS)),e.addRenderTarget("ShadowMap"+h,t.shadowMapFormat,t.shadowMapSize.x,t.shadowMapSize.y),e.addDepthStencil("ShadowDepth"+h,Se.DEPTH_STENCIL,t.shadowMapSize.x,t.shadowMapSize.y),a.enableSingleForwardPass)for(var g=t.mobileMaxSpotLightShadowMaps,m=0;m!==g;++m)e.addRenderTarget("SpotShadowMap"+m,t.shadowMapFormat,t.shadowMapSize.x,t.shadowMapSize.y),e.addDepthStencil("SpotShadowDepth"+m,Se.DEPTH_STENCIL,t.shadowMapSize.x,t.shadowMapSize.y)},i.setup=function(e,t,a,i,n){var r=i.window.renderWindowId,o=i.scene,s=o.mainLight;--a.remainingPasses,u(a.remainingPasses>=0),this.forwardLighting.cullLights(o,i.frustum),a.enableMainLightShadowMap&&(u(!!s),this._addCascadedShadowMapPass(e,t,r,s,i)),a.enableSingleForwardPass&&this.forwardLighting.addSpotlightShadowPasses(e,i,t.mobileMaxSpotLightShadowMaps),this._tryAddReflectionProbePasses(e,a,r,s,i.scene),a.remainingPasses>0||a.enableShadingScale?(n.colorName=a.enableShadingScale?"ScaledRadiance0_"+r:"Radiance0_"+r,n.depthStencilName=a.enableShadingScale?"ScaledSceneDepth_"+r:"SceneDepth_"+r):(n.colorName=a.colorName,n.depthStencilName=a.depthStencilName);var l=this._addForwardRadiancePasses(e,t,a,r,i,a.width,a.height,s,n.colorName,n.depthStencilName,!a.enableMSAA,a.enableStoreSceneDepth?Pe.STORE:Pe.DISCARD);return a.enableStoreSceneDepth||(n.depthStencilName=""),0===a.remainingPasses&&a.enableShadingScale?Ne(e,t,a,n.colorName):l},i._addCascadedShadowMapPass=function(e,t,a,i,n){var r=d.QueueHint,o=d.SceneFlags,s=e.pipelineSceneData.shadows.size,l=s.x,h=s.y,p=this._viewport;p.left=p.top=0,p.width=l,p.height=h;var c=e.addRenderPass(l,h,"default");c.name="CascadedShadowMap",c.addRenderTarget("ShadowMap"+a,we.CLEAR,Pe.STORE,new be(1,1,1,1)),c.addDepthStencil("ShadowDepth"+a,we.CLEAR,Pe.DISCARD);for(var u=e.pipelineSceneData.csmSupported?i.csmLevel:1,g=0;g!==u;++g){Ae(i,l,h,g,this._viewport,t.screenSpaceSignY);var m=c.addQueue(r.NONE,"shadow-caster");t.isWebGPU||m.setViewport(this._viewport),m.addScene(n,o.OPAQUE|o.MASK|o.SHADOW_CASTER).useLightFrustum(i,g)}},i._tryAddReflectionProbePasses=function(a,i,n,r,o){var s=e.internal.reflectionProbeManager;if(s)for(var l,h=d.ResourceResidency,p=0,u=E(s.getProbes());!(l=u()).done;){var g=l.value;if(g.needRender){var m=g.renderArea(),f=Math.max(Math.floor(m.x),1),b=Math.max(Math.floor(m.y),1);if(g.probeType===c.scene.ProbeType.PLANAR){if(!i.enablePlanarReflectionProbe)continue;var S=g.realtimePlanarTexture.window,_="PlanarProbeRT"+p,w="PlanarProbeDS"+p;a.addRenderWindow(_,i.radianceFormat,f,b,S),a.addDepthStencil(w,t.Format.DEPTH_STENCIL,f,b,h.MEMORYLESS);var P=a.addRenderPass(f,b,"default");P.name="PlanarReflectionProbe"+p,this._buildReflectionProbePass(P,i,n,g.camera,_,w,r,o)}if(4===++p)break}}},i._buildReflectionProbePass=function(e,t,a,i,n,r,o,s){void 0===s&&(s=null);var l=d.QueueHint,h=d.SceneFlags,p=t.enableMSAA?Pe.DISCARD:Pe.STORE;if(Te(i)){this._reflectionProbeClearColor.x=i.clearColor.x,this._reflectionProbeClearColor.y=i.clearColor.y,this._reflectionProbeClearColor.z=i.clearColor.z;var c=d.packRGBE(this._reflectionProbeClearColor);this._clearColor.x=c.x,this._clearColor.y=c.y,this._clearColor.z=c.z,this._clearColor.w=c.w,e.addRenderTarget(n,we.CLEAR,p,this._clearColor)}else e.addRenderTarget(n,we.LOAD,p);i.clearFlag&fe.DEPTH_STENCIL?e.addDepthStencil(r,we.CLEAR,Pe.DISCARD,i.clearDepth,i.clearStencil,i.clearFlag&fe.DEPTH_STENCIL):e.addDepthStencil(r,we.LOAD,Pe.DISCARD),t.enableMainLightShadowMap&&e.addTexture("ShadowMap"+a,"cc_shadowMap"),e.addQueue(l.NONE,"reflect-map").addScene(i,h.OPAQUE|h.MASK|h.REFLECTION_PROBE,o||void 0,s||void 0)},i._addForwardRadiancePasses=function(e,t,a,i,n,r,o,s,l,h,p,c){void 0===p&&(p=!1),void 0===c&&(c=Pe.DISCARD);var g=d.QueueHint,m=d.SceneFlags,f=n.clearColor;this._clearColor.x=f.x,this._clearColor.y=f.y,this._clearColor.z=f.z,this._clearColor.w=f.w;var b=n.viewport;this._viewport.left=Math.round(b.x*r),this._viewport.top=Math.round(b.y*o),this._viewport.width=Math.max(Math.round(b.width*r),1),this._viewport.height=Math.max(Math.round(b.height*o),1);var S=!p&&a.enableMSAA;u(!S||a.enableSingleForwardPass);var _=a.enableSingleForwardPass?this._addForwardSingleRadiancePass(e,t,a,i,n,S,r,o,s,l,h,c):this._addForwardMultipleRadiancePasses(e,a,i,n,r,o,s,l,h,c);a.enableMainLightPlanarShadowMap&&this._addPlanarShadowQueue(n,s,_);var w=m.BLEND|(n.geometryRenderer?m.GEOMETRY:m.NONE);return _.addQueue(g.BLEND).addScene(n,w,s||void 0),_},i._addForwardSingleRadiancePass=function(e,t,a,i,n,r,o,s,l,d,h,p){var c;if(u(a.enableSingleForwardPass),r){var g="MsaaRadiance"+i,m="MsaaDepthStencil"+i,f=a.settings.msaa.sampleCount,b=e.addMultisampleRenderPass(o,s,f,0,"default");b.name="MsaaForwardPass",this._buildForwardMainLightPass(b,a,i,n,g,m,Pe.DISCARD,l),b.resolveRenderTarget(g,d),c=b}else(c=e.addRenderPass(o,s,"default")).name="ForwardPass",this._buildForwardMainLightPass(c,a,i,n,d,h,p,l);return u(void 0!==c),this.forwardLighting.addLightQueues(c,n,t.mobileMaxSpotLightShadowMaps),c},i._addForwardMultipleRadiancePasses=function(e,t,a,i,n,r,o,s,l,d){u(!t.enableSingleForwardPass);var h=e.addRenderPass(n,r,"default");h.name="ForwardPass";var p=this.forwardLighting.isMultipleLightPassesNeeded()?Pe.STORE:d;return this._buildForwardMainLightPass(h,t,a,i,s,l,p,o),h=this.forwardLighting.addLightPasses(s,l,d,a,n,r,i,this._viewport,e,h)},i._buildForwardMainLightPass=function(e,t,a,i,n,r,o,s,l){void 0===l&&(l=null);var h=d.QueueHint,p=d.SceneFlags;e.setViewport(this._viewport);var c=t.enableMSAA?Pe.DISCARD:Pe.STORE;Te(i)?e.addRenderTarget(n,we.CLEAR,c,this._clearColor):e.addRenderTarget(n,we.LOAD,c),i.clearFlag&fe.DEPTH_STENCIL?e.addDepthStencil(r,we.CLEAR,o,i.clearDepth,i.clearStencil,i.clearFlag&fe.DEPTH_STENCIL):e.addDepthStencil(r,we.LOAD,o),t.enableMainLightShadowMap&&e.addTexture("ShadowMap"+a,"cc_shadowMap"),e.addQueue(h.NONE).addScene(i,p.OPAQUE|p.MASK,s||void 0,l||void 0)},i._addPlanarShadowQueue=function(e,t,a){var i=d.QueueHint,n=d.SceneFlags;a.addQueue(i.BLEND,"planar-shadow").addScene(e,n.SHADOW_CASTER|n.PLANAR_SHADOW|n.BLEND,t||void 0)},a}();Be.ConfigOrder=100,Be.RenderOrder=100;var ze=function(){function e(){this._clearColorTransparentBlack=new be(0,0,0,0),this._bloomParams=new b(0,0,0,0),this._bloomTexSize=new b(0,0,0,0),this._bloomWidths=[],this._bloomHeights=[],this._bloomTexNames=[]}var t=e.prototype;return t.getConfigOrder=function(){return 0},t.getRenderOrder=function(){return 200},t.configCamera=function(e,t,a){a.enableBloom=a.settings.bloom.enabled&&!!a.settings.bloom.material,a.enableBloom&&++a.remainingPasses},t.windowResize=function(e,t,a,i){if(a.enableBloom)for(var n=i.renderWindowId,r=a.width,o=a.height,s=0;s!==a.settings.bloom.iterations+1;++s)r=Math.max(Math.floor(r/2),1),o=Math.max(Math.floor(o/2),1),e.addRenderTarget("BloomTex"+n+"_"+s,a.radianceFormat,r,o)},t.setup=function(e,t,a,i,n,r){if(!a.enableBloom)return r;--a.remainingPasses,u(a.remainingPasses>=0);var o=i.window.renderWindowId;return u(!!a.settings.bloom.material),this._addKawaseDualFilterBloomPasses(e,t,a,a.settings,a.settings.bloom.material,o,a.width,a.height,n.colorName)},t._addKawaseDualFilterBloomPasses=function(e,t,a,i,n,r,o,s,l){var h=d.QueueHint,p=i.bloom.iterations,c=p+1;this._bloomWidths.length=c,this._bloomHeights.length=c,this._bloomWidths[0]=Math.max(Math.floor(o/2),1),this._bloomHeights[0]=Math.max(Math.floor(s/2),1);for(var u=1;u!==c;++u)this._bloomWidths[u]=Math.max(Math.floor(this._bloomWidths[u-1]/2),1),this._bloomHeights[u]=Math.max(Math.floor(this._bloomHeights[u-1]/2),1);this._bloomTexNames.length=c;for(var g=0;g!==c;++g)this._bloomTexNames[g]="BloomTex"+r+"_"+g;this._bloomParams.x=t.useFloatOutput?1:0,this._bloomParams.x=0,this._bloomParams.z=i.bloom.threshold,this._bloomParams.w=i.bloom.enableAlphaMask?1:0;var m=e.addRenderPass(this._bloomWidths[0],this._bloomHeights[0],"cc-bloom-prefilter");m.addRenderTarget(this._bloomTexNames[0],we.CLEAR,Pe.STORE,this._clearColorTransparentBlack),m.addTexture(l,"inputTexture"),m.setVec4("g_platform",t.platform),m.setVec4("bloomParams",this._bloomParams),m.addQueue(h.OPAQUE).addFullscreenQuad(n,0);for(var f=1;f!==c;++f){var b=e.addRenderPass(this._bloomWidths[f],this._bloomHeights[f],"cc-bloom-downsample");b.addRenderTarget(this._bloomTexNames[f],we.CLEAR,Pe.STORE,this._clearColorTransparentBlack),b.addTexture(this._bloomTexNames[f-1],"bloomTexture"),this._bloomTexSize.x=this._bloomWidths[f-1],this._bloomTexSize.y=this._bloomHeights[f-1],b.setVec4("g_platform",t.platform),b.setVec4("bloomTexSize",this._bloomTexSize),b.addQueue(h.OPAQUE).addFullscreenQuad(n,1)}for(var S=p;S-- >0;){var _=e.addRenderPass(this._bloomWidths[S],this._bloomHeights[S],"cc-bloom-upsample");_.addRenderTarget(this._bloomTexNames[S],we.CLEAR,Pe.STORE,this._clearColorTransparentBlack),_.addTexture(this._bloomTexNames[S+1],"bloomTexture"),this._bloomTexSize.x=this._bloomWidths[S+1],this._bloomTexSize.y=this._bloomHeights[S+1],_.setVec4("g_platform",t.platform),_.setVec4("bloomTexSize",this._bloomTexSize),_.addQueue(h.OPAQUE).addFullscreenQuad(n,2)}var w=e.addRenderPass(o,s,"cc-bloom-combine");return w.addRenderTarget(l,we.LOAD,Pe.STORE),w.addTexture(this._bloomTexNames[0],"bloomTexture"),w.setVec4("g_platform",t.platform),w.setVec4("bloomParams",this._bloomParams),w.addQueue(h.BLEND).addFullscreenQuad(n,3),0===a.remainingPasses?Ne(e,t,a,l):w},e}(),He=function(){function e(){this._colorGradingTexSize=new f(0,0)}var t=e.prototype;return t.getConfigOrder=function(){return 0},t.getRenderOrder=function(){return 300},t.configCamera=function(e,t,a){var i=a.settings;a.enableColorGrading=i.colorGrading.enabled&&!!i.colorGrading.material&&!!i.colorGrading.colorGradingMap,a.enableToneMapping=a.enableHDR||a.enableColorGrading,a.enableToneMapping&&++a.remainingPasses},t.windowResize=function(e,t,a){a.enableColorGrading&&(u(!!a.settings.colorGrading.material),a.settings.colorGrading.material.setProperty("colorGradingMap",a.settings.colorGrading.colorGradingMap))},t.setup=function(e,t,a,i,n,r){if(!a.enableToneMapping)return r;if(--a.remainingPasses,u(a.remainingPasses>=0),0===a.remainingPasses)return this._addCopyAndTonemapPass(e,t,a,a.width,a.height,n.colorName,a.colorName);var o=a.renderWindowId,s=a.enableShadingScale?"ScaledLdrColor":"LdrColor",l=Ge(n.colorName,s,o),d=n.colorName;return n.colorName=l,this._addCopyAndTonemapPass(e,t,a,a.width,a.height,d,l)},t._addCopyAndTonemapPass=function(e,t,a,i,n,r,o){var s,l=a.settings;if(a.enableColorGrading){u(!!l.colorGrading.material),u(!!l.colorGrading.colorGradingMap);var h=l.colorGrading.colorGradingMap;this._colorGradingTexSize.x=h.width,this._colorGradingTexSize.y=h.height;var p=h.width===h.height;(s=p?e.addRenderPass(i,n,"cc-color-grading-8x8"):e.addRenderPass(i,n,"cc-color-grading-nx1")).addRenderTarget(o,we.CLEAR,Pe.STORE,Fe),s.addTexture(r,"sceneColorMap"),s.setVec4("g_platform",t.platform),s.setVec2("lutTextureSize",this._colorGradingTexSize),s.setFloat("contribute",l.colorGrading.contribute),s.addQueue(d.QueueHint.OPAQUE).addFullscreenQuad(l.colorGrading.material,p?1:0)}else(s=e.addRenderPass(i,n,"cc-tone-mapping")).addRenderTarget(o,we.CLEAR,Pe.STORE,Fe),s.addTexture(r,"inputTexture"),s.setVec4("g_platform",t.platform),l.toneMapping.material?s.addQueue(d.QueueHint.OPAQUE).addFullscreenQuad(l.toneMapping.material,0):(u(!!a.copyAndTonemapMaterial),s.addQueue(d.QueueHint.OPAQUE).addFullscreenQuad(a.copyAndTonemapMaterial,0));return s},e}(),Ie=function(){function e(){this._fxaaParams=new b(0,0,0,0)}var t=e.prototype;return t.getConfigOrder=function(){return 0},t.getRenderOrder=function(){return 400},t.configCamera=function(e,t,a){a.enableFXAA=a.settings.fxaa.enabled&&!!a.settings.fxaa.material,a.enableFXAA&&++a.remainingPasses},t.setup=function(e,t,a,i,n,r){if(!a.enableFXAA)return r;--a.remainingPasses,u(a.remainingPasses>=0);var o=a.renderWindowId,s=a.enableShadingScale?"ScaledLdrColor":"LdrColor",l=Ge(n.colorName,s,o);if(u(!!a.settings.fxaa.material),0===a.remainingPasses)return a.enableShadingScale?(this._addFxaaPass(e,t,a.settings.fxaa.material,a.width,a.height,n.colorName,l),Ne(e,t,a,l)):(u(a.width===a.nativeWidth),u(a.height===a.nativeHeight),this._addFxaaPass(e,t,a.settings.fxaa.material,a.width,a.height,n.colorName,a.colorName));var d=n.colorName;return n.colorName=l,this._addFxaaPass(e,t,a.settings.fxaa.material,a.width,a.height,d,l)},t._addFxaaPass=function(e,t,a,i,n,r,o){this._fxaaParams.x=i,this._fxaaParams.y=n,this._fxaaParams.z=1/i,this._fxaaParams.w=1/n;var s=e.addRenderPass(i,n,"cc-fxaa");return s.addRenderTarget(o,we.CLEAR,Pe.STORE,Fe),s.addTexture(r,"sceneColorMap"),s.setVec4("g_platform",t.platform),s.setVec4("texSize",this._fxaaParams),s.addQueue(d.QueueHint.OPAQUE).addFullscreenQuad(a,0),s},e}(),We=function(){function e(){this._fsrParams=new b(0,0,0,0),this._fsrTexSize=new b(0,0,0,0)}var t=e.prototype;return t.getConfigOrder=function(){return 0},t.getRenderOrder=function(){return 500},t.configCamera=function(e,t,a){a.enableFSR=a.settings.fsr.enabled&&!!a.settings.fsr.material&&a.enableShadingScale&&a.shadingScale<1,a.enableFSR&&++a.remainingPasses},t.setup=function(e,t,a,i,n,r){if(!a.enableFSR)return r;--a.remainingPasses;var o=n.colorName,s=0===a.remainingPasses?a.colorName:Ge(n.colorName,"UiColor",a.renderWindowId);return n.colorName=s,u(!!a.settings.fsr.material),this._addFsrPass(e,t,a,a.settings,a.settings.fsr.material,a.renderWindowId,a.width,a.height,o,a.nativeWidth,a.nativeHeight,s)},t._addFsrPass=function(e,t,a,i,n,r,o,s,l,h,p,c){this._fsrTexSize.x=o,this._fsrTexSize.y=s,this._fsrTexSize.z=h,this._fsrTexSize.w=p,this._fsrParams.x=P(1-i.fsr.sharpness,.02,.98);var u=Ge(c,"UiColor",r),g=e.addRenderPass(h,p,"cc-fsr-easu");g.addRenderTarget(u,we.CLEAR,Pe.STORE,Fe),g.addTexture(l,"outputResultMap"),g.setVec4("g_platform",t.platform),g.setVec4("fsrTexSize",this._fsrTexSize),g.addQueue(d.QueueHint.OPAQUE).addFullscreenQuad(n,0);var m=e.addRenderPass(h,p,"cc-fsr-rcas");return m.addRenderTarget(c,we.CLEAR,Pe.STORE,Fe),m.addTexture(u,"outputResultMap"),m.setVec4("g_platform",t.platform),m.setVec4("fsrTexSize",this._fsrTexSize),m.setVec4("fsrParams",this._fsrParams),m.addQueue(d.QueueHint.OPAQUE).addFullscreenQuad(n,1),m},e}(),ke=function(){function e(){}var t=e.prototype;return t.getConfigOrder=function(){return 0},t.getRenderOrder=function(){return 1e3},t.setup=function(e,t,a,i,n,r){u(!!r);var o=d.SceneFlags.UI;return a.enableProfiler&&(o|=d.SceneFlags.PROFILER,r.showStatistics=!0),r.addQueue(d.QueueHint.BLEND,"default","default").addScene(i,o),r},e}();if(d){var Ue=d.QueueHint,je=d.SceneFlags,Ve=function(){function a(){this._pipelineEvent=e.director.root.pipelineEvent,this._forwardPass=new Be,this._bloomPass=new ze,this._toneMappingPass=new He,this._fxaaPass=new Ie,this._fsrPass=new We,this._uiPass=new ke,this._clearColor=new be(0,0,0,1),this._viewport=new Me,this._configs=new xe,this._cameraConfigs=new Oe,this._copyAndTonemapMaterial=new s,this._initialized=!1,this._passBuilders=[]}var i=a.prototype;return i._setupPipelinePreview=function(e,t){if(e.cameraUsage===Re.SCENE_VIEW||e.cameraUsage===Re.PREVIEW){var a=d.getEditorPipelineSettings();t.settings=a||Le}else e.pipelineSettings?t.settings=e.pipelineSettings:t.settings=Le},i._preparePipelinePasses=function(e){var t=this._passBuilders;t.length=0;var a=e.settings;if(a._passes){for(var i,n=E(a._passes);!(i=n()).done;){var r=i.value;t.push(r)}u(t.length===a._passes.length)}t.push(this._forwardPass),a.bloom.enabled&&t.push(this._bloomPass),t.push(this._toneMappingPass),a.fxaa.enabled&&t.push(this._fxaaPass),a.fsr.enabled&&t.push(this._fsrPass),t.push(this._uiPass)},i._setupBuiltinCameraConfigs=function(e,a,i){var n=e.window,r=e.cameraUsage===Re.GAME&&!!n.swapchain;i.isMainGameWindow=r,i.renderWindowId=n.renderWindowId,i.colorName=n.colorName,i.depthStencilName=n.depthStencilName,i.enableFullPipeline=0!=(e.visibility&g.Enum.DEFAULT),i.enableProfiler=false,i.remainingPasses=0,i.shadingScale=i.settings.shadingScale,i.enableShadingScale=i.settings.enableShadingScale&&1!==i.shadingScale,i.nativeWidth=Math.max(Math.floor(n.width),1),i.nativeHeight=Math.max(Math.floor(n.height),1),i.width=i.enableShadingScale?Math.max(Math.floor(i.nativeWidth*i.shadingScale),1):i.nativeWidth,i.height=i.enableShadingScale?Math.max(Math.floor(i.nativeHeight*i.shadingScale),1):i.nativeHeight,i.enableHDR=i.enableFullPipeline&&a.useFloatOutput,i.radianceFormat=i.enableHDR?t.Format.RGBA16F:t.Format.RGBA8,i.copyAndTonemapMaterial=this._copyAndTonemapMaterial,i.enableStoreSceneDepth=!1},i._setupCameraConfigs=function(e,t,a){this._setupPipelinePreview(e,a),this._preparePipelinePasses(a),this._passBuilders.sort((function(e,t){return e.getConfigOrder()-t.getConfigOrder()})),this._setupBuiltinCameraConfigs(e,t,a);for(var i,n=E(this._passBuilders);!(i=n()).done;){var r=i.value;r.configCamera&&r.configCamera(e,t,a)}},i.windowResize=function(e,t,a,i,n){De(e,this._configs),this._setupCameraConfigs(a,this._configs,this._cameraConfigs);var r=t.renderWindowId;e.addRenderWindow(this._cameraConfigs.colorName,Se.RGBA8,i,n,t,this._cameraConfigs.depthStencilName);var o=this._cameraConfigs.width,s=this._cameraConfigs.height;this._cameraConfigs.enableShadingScale?(e.addDepthStencil("ScaledSceneDepth_"+r,Se.DEPTH_STENCIL,o,s),e.addRenderTarget("ScaledRadiance0_"+r,this._cameraConfigs.radianceFormat,o,s),e.addRenderTarget("ScaledRadiance1_"+r,this._cameraConfigs.radianceFormat,o,s),e.addRenderTarget("ScaledLdrColor0_"+r,Se.RGBA8,o,s),e.addRenderTarget("ScaledLdrColor1_"+r,Se.RGBA8,o,s)):(e.addDepthStencil("SceneDepth_"+r,Se.DEPTH_STENCIL,o,s),e.addRenderTarget("Radiance0_"+r,this._cameraConfigs.radianceFormat,o,s),e.addRenderTarget("Radiance1_"+r,this._cameraConfigs.radianceFormat,o,s),e.addRenderTarget("LdrColor0_"+r,Se.RGBA8,o,s),e.addRenderTarget("LdrColor1_"+r,Se.RGBA8,o,s)),e.addRenderTarget("UiColor0_"+r,Se.RGBA8,i,n),e.addRenderTarget("UiColor1_"+r,Se.RGBA8,i,n);for(var l,d=E(this._passBuilders);!(l=d()).done;){var h=l.value;h.windowResize&&h.windowResize(e,this._configs,this._cameraConfigs,t,a,i,n)}},i.setup=function(e,t){if(!this._initMaterials(t))for(var a,i=E(e);!(a=i()).done;){var n=a.value;n.scene&&n.window&&(this._setupCameraConfigs(n,this._configs,this._cameraConfigs),this._pipelineEvent.emit(m.RENDER_CAMERA_BEGIN,n),this._cameraConfigs.enableFullPipeline?this._buildForwardPipeline(t,n,n.scene,this._passBuilders):this._buildSimplePipeline(t,n),this._pipelineEvent.emit(m.RENDER_CAMERA_END,n))}},i._buildSimplePipeline=function(e,t){var a=Math.max(Math.floor(t.window.width),1),i=Math.max(Math.floor(t.window.height),1),n=this._cameraConfigs.colorName,r=this._cameraConfigs.depthStencilName,o=t.viewport;this._viewport.left=Math.round(o.x*a),this._viewport.top=Math.round(o.y*i),this._viewport.width=Math.max(Math.round(o.width*a),1),this._viewport.height=Math.max(Math.round(o.height*i),1);var s=t.clearColor;this._clearColor.x=s.x,this._clearColor.y=s.y,this._clearColor.z=s.z,this._clearColor.w=s.w;var l=e.addRenderPass(a,i,"default");Te(t)?l.addRenderTarget(n,we.CLEAR,Pe.STORE,this._clearColor):l.addRenderTarget(n,we.LOAD,Pe.STORE),t.clearFlag&fe.DEPTH_STENCIL?l.addDepthStencil(r,we.CLEAR,Pe.DISCARD,t.clearDepth,t.clearStencil,t.clearFlag&fe.DEPTH_STENCIL):l.addDepthStencil(r,we.LOAD,Pe.DISCARD),l.setViewport(this._viewport),l.addQueue(Ue.OPAQUE).addScene(t,je.OPAQUE);var d=je.BLEND|je.UI;this._cameraConfigs.enableProfiler&&(d|=je.PROFILER,l.showStatistics=!0),l.addQueue(Ue.BLEND).addScene(t,d)},i._buildForwardPipeline=function(e,t,a,i){!function(e){e.sort((function(e,t){return e.getRenderOrder()-t.getRenderOrder()}))}(i);for(var n,r={colorName:"",depthStencilName:""},o=void 0,s=E(i);!(n=s()).done;){var l=n.value;l.setup&&(o=l.setup(e,this._configs,this._cameraConfigs,t,r,o))}u(0===this._cameraConfigs.remainingPasses)},i._initMaterials=function(e){return this._initialized?0:(De(e,this._configs),this._copyAndTonemapMaterial._uuid="builtin-pipeline-tone-mapping-material",this._copyAndTonemapMaterial.initialize({effectName:"pipeline/post-process/tone-mapping"}),this._copyAndTonemapMaterial.effectAsset&&(this._initialized=!0),this._initialized?0:1)},a}();d.setCustomPipeline("Builtin",new Ve)}e._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/internal', 'bundle://internal/internal.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});